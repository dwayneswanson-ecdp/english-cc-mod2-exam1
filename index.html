<!DOCTYPE html>
<html lang="en" translate="no">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="google" content="notranslate">
<meta http-equiv="Content-Language" content="en">
<title>English Exam – Business Resources</title>

<!-- Quill.js styling -->
<link href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css" rel="stylesheet">

<style>
  body {
    font-family: Arial, Helvetica, sans-serif;
    background: #f8f9fb;
    margin: 0;
    color: #222;
    font-size: 16px;
    line-height: 1.6;
  }

  header {
    background: linear-gradient(135deg, #004080, #0066cc);
    color: white;
    padding: 25px 20px;
    text-align: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  }

  header h1 { margin: 0; font-size: 1.9em; letter-spacing: 0.4px; }
  #timer { font-weight: bold; margin-top: 10px; }

  main {
    max-width: 900px;
    margin: 40px auto;
    background: white;
    border-radius: 12px;
    box-shadow: 0 0 12px rgba(0,0,0,0.1);
    padding: 40px;
  }

  /* Centered login */
  #login {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: calc(100vh - 160px);
    text-align: center;
  }

  #login h2 {
    color: #004080;
    margin-top: 0;
  }

  #login input {
    width: 80%;
    padding: 10px;
    margin: 8px 0;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 16px;
  }

  #login button {
    margin-top: 10px;
    background: #004080;
    color: white;
    border: none;
    padding: 12px 28px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
  }

  #login button:hover { background: #003366; }

  #exam, #partA, #partB { display: none; }
  #exam.active, #partA.active, #partB.active { display: block; }

  select {
    width: 100%;
    padding: 8px;
    margin: 8px 0;
    border-radius: 6px;
    border: 1px solid #ccc;
    white-space: normal;
    word-wrap: break-word;
    max-width: 100%;
  }

  button {
    background: #004080;
    color: white;
    padding: 10px 24px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
  }
  button:hover { background: #003366; }

  .btn-row { display: flex; justify-content: space-between; margin-top: 20px; }

  .editor-card {
    border: 1px solid #e3e6ee;
    border-radius: 8px;
    overflow: hidden;
    min-height: 300px;
  }

  .ql-toolbar.ql-snow {
    background: #f4f7fc;
    border: none;
    border-bottom: 1px solid #ccc;
  }

  .ql-container.ql-snow {
    border: none;
    height: 300px;
    min-height: 300px;
    cursor: text;
  }
</style>
</head>

<body>
<header>
  <h1>English Exam – Business Resources (MDO2G3)</h1>
  <div id="timer"></div>
</header>

<main>
  <!-- Centered Login Screen -->
  <section id="login" class="active">
    <h2>Start Exam</h2>
    <p>Enter your details to begin. Once started, you will have <b>40 minutes</b>.</p>
    <input type="text" id="studentName" placeholder="Full Name" required>
    <input type="email" id="studentEmail" placeholder="Email" required>
    <input type="text" id="classCode" placeholder="Class Code (MDO2G3)" required>
    <button id="startBtn">Start Exam</button>
  </section>

  <!-- Exam -->
  <section id="exam">
    <form id="examForm">
      <input type="hidden" name="studentName" id="studentNameField">
      <input type="hidden" name="studentEmail" id="studentEmailField">
      <input type="hidden" name="classCode" id="classCodeField">

      <!-- Part A -->
      <div id="partA" class="active">
        <h2>Part A – Vocabulary Matching</h2>
        <ol>
          <li>Budget<select name="q1">
            <option value="">-- Choose --</option>
            <option>A plan for how money will be spent during a specific period.</option>
            <option>The time between ordering and receiving something.</option>
            <option>The goods and materials a company holds.</option>
            <option>A company providing goods or services to another.</option>
          </select></li>
          <li>Forecast<select name="q2">
            <option value="">-- Choose --</option>
            <option>A prediction of future sales, costs, or results.</option>
            <option>Ongoing expenses not tied to one product or service.</option>
            <option>Financial gain or loss compared to cost.</option>
            <option>Number of employees in a department.</option>
          </select></li>
          <li>KPI<select name="q3">
            <option value="">-- Choose --</option>
            <option>A measurable value showing how effectively goals are achieved.</option>
            <option>A plan for money spending.</option>
            <option>The time between order and delivery.</option>
            <option>A prediction of sales.</option>
          </select></li>
          <li>Supplier<select name="q4">
            <option value="">-- Choose --</option>
            <option>A company providing goods or services to another.</option>
            <option>Expenses not linked to a product.</option>
            <option>The financial return on investment.</option>
            <option>A staff member giving feedback.</option>
          </select></li>
          <li>Lead Time<select name="q5">
            <option value="">-- Choose --</option>
            <option>The time between ordering and receiving something.</option>
            <option>Extra costs of running a business.</option>
            <option>Number of employees.</option>
            <option>A business sustainability report.</option>
          </select></li>
          <li>Inventory<select name="q6">
            <option value="">-- Choose --</option>
            <option>The goods and materials a company holds.</option>
            <option>The expected revenue.</option>
            <option>The time between orders.</option>
            <option>Company overhead costs.</option>
          </select></li>
          <li>Overhead<select name="q7">
            <option value="">-- Choose --</option>
            <option>Ongoing expenses not tied to one product or service.</option>
            <option>A plan for company goals.</option>
            <option>The delivery delay period.</option>
            <option>The total sales revenue.</option>
          </select></li>
          <li>Sustainability<select name="q8">
            <option value="">-- Choose --</option>
            <option>Managing resources for long-term balance.</option>
            <option>The company’s annual sales.</option>
            <option>A measurable performance indicator.</option>
            <option>Stock of materials.</option>
          </select></li>
          <li>ROI<select name="q9">
            <option value="">-- Choose --</option>
            <option>Financial gain or loss compared to cost of investment.</option>
            <option>Total operating expenses.</option>
            <option>Employee satisfaction level.</option>
            <option>Plan for spending.</option>
          </select></li>
          <li>Headcount<select name="q10">
            <option value="">-- Choose --</option>
            <option>Number of employees in a company or department.</option>
            <option>Amount of raw materials held.</option>
            <option>Prediction of future costs.</option>
            <option>Profit after expenses.</option>
          </select></li>
        </ol>

        <div class="btn-row">
          <button type="button" id="toPartB">Next → Part B</button>
        </div>
      </div>

      <!-- Part B -->
      <div id="partB">
        <h2>Part B – Writing Task</h2>
        <p>You are a team leader. One of your suppliers has delayed an important delivery.  
        Write a short email to your manager explaining the problem and suggesting a solution.  
        Use at least <b>3 words from the vocabulary list</b>.</p>

        <div class="editor-card">
          <div id="editor"></div>
        </div>

        <div class="btn-row">
          <button type="button" id="toPartA">← Back to Part A</button>
          <button type="submit">Submit Exam</button>
        </div>
      </div>
    </form>
  </section>
</main>

<!-- Scripts at end so buttons exist before JS loads -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>

<script>
emailjs.init("Bb0oPYBiZGQcyIz5r");

const login = document.getElementById("login");
const exam = document.getElementById("exam");
const startBtn = document.getElementById("startBtn");
const toPartA = document.getElementById("toPartA");
const toPartB = document.getElementById("toPartB");
const partA = document.getElementById("partA");
const partB = document.getElementById("partB");
const timerDisplay = document.getElementById("timer");
const form = document.getElementById("examForm");

let timeLeft = 40 * 60;
let timer;

const correctAnswers = {
  q1:"A plan for how money will be spent during a specific period.",
  q2:"A prediction of future sales, costs, or results.",
  q3:"A measurable value showing how effectively goals are achieved.",
  q4:"A company providing goods or services to another.",
  q5:"The time between ordering and receiving something.",
  q6:"The goods and materials a company holds.",
  q7:"Ongoing expenses not tied to one product or service.",
  q8:"Managing resources for long-term balance.",
  q9:"Financial gain or loss compared to cost of investment.",
  q10:"Number of employees in a company or department."
};

const wordNames = ["Budget","Forecast","KPI","Supplier","Lead Time","Inventory","Overhead","Sustainability","ROI","Headcount"];

const quill = new Quill('#editor', {
  theme: 'snow',
  modules: { toolbar: [['bold','italic','underline'],[{ list: 'ordered' }, { list: 'bullet' }],['clean']] }
});
quill.root.style.height = "300px";
quill.root.style.cursor = "text";

function startTimer() {
  timer = setInterval(() => {
    timeLeft--;
    const m = Math.floor(timeLeft / 60), s = timeLeft % 60;
    timerDisplay.textContent = `Time Remaining: ${m}:${s.toString().padStart(2,"0")}`;
    if (timeLeft <= 0) { clearInterval(timer); submitExam(); }
  }, 1000);
}

function enableFullScreen() {
  document.documentElement.requestFullscreen?.();
  document.addEventListener("fullscreenchange", () => {
    if (!document.fullscreenElement) {
      alert("Exam terminated. Fullscreen required.");
      location.reload();
    }
  });
}

startBtn.addEventListener("click", () => {
  const name = document.getElementById("studentName").value.trim();
  const email = document.getElementById("studentEmail").value.trim();
  const code = document.getElementById("classCode").value.trim();

  if (!name || !email) return alert("Please fill in your details.");
  if (code !== "MDO2G3") return alert("Invalid class code.");

  document.getElementById("studentNameField").value = name;
  document.getElementById("studentEmailField").value = email;
  document.getElementById("classCodeField").value = code;

  login.classList.remove("active");
  exam.classList.add("active");
  partA.classList.add("active");
  enableFullScreen();
  startTimer();
});

toPartB.addEventListener("click", () => {
  partA.classList.remove("active");
  partB.classList.add("active");
});
toPartA.addEventListener("click", () => {
  partB.classList.remove("active");
  partA.classList.add("active");
});

form.addEventListener("submit", e => {
  e.preventDefault();
  submitExam();
});

function submitExam() {
  clearInterval(timer);
  const fd = new FormData(form);
  const name = fd.get("studentName") || document.getElementById("studentNameField").value;
  const email = fd.get("studentEmail") || document.getElementById("studentEmailField").value;
  const minutesUsed = 40 - Math.floor(timeLeft / 60);
  const emailHtml = quill.root.innerHTML.trim();

  let score = 0;
  const rows = [];
  for (let i = 1; i <= 10; i++) {
    const sel = fd.get("q" + i) || "No answer";
    const corr = correctAnswers["q" + i];
    const ok = sel === corr;
    if (ok) score++;
    rows.push({ word: wordNames[i-1], sel, corr, ok });
  }

  const htmlReport = `
  <h2 style="color:#004080;">English Exam – ${name}</h2>
  <p><b>Student:</b> ${name}<br><b>Email:</b> ${email}<br><b>Time Used:</b> ${minutesUsed} min</p>
  <hr>
  <h3>Part A – Vocabulary</h3>
  <table style="border-collapse:collapse;width:100%;">
  ${rows.map(r=>`
    <tr>
      <td style="border:1px solid #ccc;padding:5px;">${r.word}</td>
      <td style="border:1px solid #ccc;padding:5px;">${r.sel}</td>
      <td style="border:1px solid #ccc;padding:5px;color:${r.ok?'green':'red'};">${r.ok?'✅':'❌'} ${r.ok?'':'→ '+r.corr}</td>
    </tr>`).join("")}
  </table>
  <p><b>Part A Score:</b> ${score}/10</p>
  <hr>
  <h3>Part B – Student Response</h3>
  <div style="border:1px solid #ccc;padding:10px;border-radius:6px;background:#f9f9f9;">${emailHtml}</div>
  <p><b>Instructor Comments:</b></p>
  <p style="border:1px solid #ccc;padding:10px;border-radius:6px;background:#fdfdfd;">[Type feedback here]</p>
  <p><b>Final Score:</b> ___ / 20</p>`;

  emailjs.send("service_opm4h6b","template_r0u784p",{
    from_name:name,
    from_email:email,
    subject:`${name} – English Exam – Business Resources (MDO2G3)`,
    message_html:htmlReport
  }).then(()=>{
    alert("✅ Exam submitted successfully.");
    exam.style.display = "none";
  }).catch(err=>{
    alert("❌ Error sending exam: "+err.text);
  });
}
</script>
</body>
</html>
