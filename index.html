<!DOCTYPE html>
<html lang="en" translate="no">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="google" content="notranslate">
<meta http-equiv="Content-Language" content="en">
<meta name="robots" content="no-translate">
<title>English Exam ‚Äì Business Resources</title>

<!-- Quill CSS -->
<link href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css" rel="stylesheet">

<style>
  /* üîí Prevent translation and text copying across browsers */
  html, body { translate: none !important; -webkit-user-select: none; user-select: none; -webkit-touch-callout: none; }
  * { translate: none !important; }

  body {
    font-family: Arial, Helvetica, sans-serif;
    background: #f8f9fb;
    margin: 0;
    color: #222;
    font-size: 16px;
    line-height: 1.6;
  }

  header {
    background: linear-gradient(135deg, #004080, #0066cc);
    color: #ffffff;
    padding: 25px 20px;
    text-align: center;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
  }

  header h1 {
    color: #ffffff;
    font-size: 1.9em;
    margin: 0;
    letter-spacing: 0.5px;
  }

  #timer { text-align: right; font-weight: bold; color: #ffffff; margin-top: 10px; }

  main {
    max-width: 900px;
    margin: 40px auto;
    background: #fff;
    padding: 40px;
    border-radius: 12px;
    box-shadow: 0 0 12px rgba(0, 0, 0, 0.1);
  }

  section { margin-bottom: 32px; }
  .divider { border-bottom: 1px solid #ddd; padding-bottom: 24px; margin-bottom: 28px; }

  /* Center login box */
  #login {
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    padding: 40px;
    max-width: 520px;
    margin: 80px auto;
    text-align: left;
  }
  #login h2 { color: #004080; margin-top: 0; text-align: center; }

  label { display:block; margin: 12px 0 8px; font-weight: bold; }
  input[type="text"], input[type="email"], select { width: 100%; padding: 10px; border:1px solid #ccc; border-radius:6px; }
  textarea { width: 100%; padding: 10px; border:1px solid #ccc; border-radius:6px; }

  /* Make dropdowns roomy so options don‚Äôt get covered */
  select {
    width: 100%;
    max-width: none;
    white-space: normal;
    word-wrap: break-word;
  }

  button {
    background:#004080; color:#fff; border:none; padding:12px 28px; border-radius:6px; cursor:pointer; font-size:16px;
  }
  button:hover { background:#003366; }
  .btn-row { display:flex; gap:12px; flex-wrap: wrap; }
  .btn-light { background:#e9eef7; color:#004080; }
  .btn-light:hover { background:#dbe6f7; }

  ol li { margin-bottom: 14px; }

  /* Two-page layout sections */
  #partA, #partB { display:none; }
  #partA.active, #partB.active { display:block; }

  /* Quill editor container */
  .editor-card {
    border:1px solid #e3e6ee; border-radius:12px; overflow:hidden; box-shadow:0 2px 6px rgba(0,0,0,0.06);
  }
  .ql-toolbar.ql-snow { border:none; border-bottom:1px solid #e3e6ee; background:#f9fbff; }
  .ql-container.ql-snow { border:none; min-height: 260px; }

  .note { font-size: 13px; color:#555; }

</style>

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<!-- Quill JS -->
<script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  emailjs.init("Bb0oPYBiZGQcyIz5r");

  const login = document.getElementById("login");
  const exam = document.getElementById("exam");
  const partA = document.getElementById("partA");
  const partB = document.getElementById("partB");
  const timerDisplay = document.getElementById("timer");
  const form = document.getElementById("examForm");

  let timeLeft = 40 * 60, timerInt;

  function startTimer() {
    timerInt = setInterval(() => {
      timeLeft--;
      const m = Math.floor(timeLeft / 60), s = timeLeft % 60;
      timerDisplay.textContent = `Time Remaining: ${m}:${s.toString().padStart(2, "0")}`;
      if (timeLeft <= 0) {
        clearInterval(timerInt);
        submitExam();
      }
    }, 1000);
  }

  function terminateExam() {
    form.reset();
    Array.from(form.elements).forEach(el => el.disabled = true);
    const overlay = document.createElement("div");
    overlay.innerHTML = `
      <div style="
        position:fixed; inset:0; background:rgba(0,0,0,0.9); color:#fff;
        display:flex; align-items:center; justify-content:center; z-index:9999; text-align:center; padding:20px;">
        <div><h2>‚ö†Ô∏è Exam Terminated</h2><p>You exited fullscreen. Inputs were erased for security.</p></div>
      </div>`;
    document.body.appendChild(overlay);
    setTimeout(() => location.reload(), 8000);
  }

  function enableFullScreen() {
    document.documentElement.requestFullscreen?.().catch(() => {});
    document.addEventListener("fullscreenchange", () => {
      if (!document.fullscreenElement) terminateExam();
    });
  }

  document.addEventListener("copy", e => e.preventDefault());
  document.addEventListener("cut", e => e.preventDefault());
  document.addEventListener("paste", e => e.preventDefault());
  document.addEventListener("contextmenu", e => e.preventDefault());
  document.addEventListener("keydown", e => {
    if ((e.ctrlKey || e.metaKey) && ["c","v","x","u","a"].includes(e.key.toLowerCase())) e.preventDefault();
    if (e.key === "F12" || e.key === "Escape") e.preventDefault();
  });

  const correctAnswers = {
    q1: "A plan for how money will be spent during a specific period.",
    q2: "A prediction of future sales, costs, or results.",
    q3: "A measurable value showing how effectively goals are achieved.",
    q4: "A company providing goods or services to another.",
    q5: "The time between ordering and receiving something.",
    q6: "The goods and materials a company holds.",
    q7: "Ongoing expenses not tied to one product or service.",
    q8: "Managing resources for long-term balance.",
    q9: "Financial gain or loss compared to cost of investment.",
    q10: "Number of employees in a company or department."
  };
  const wordNames = ["Budget","Forecast","KPI","Supplier","Lead Time","Inventory","Overhead","Sustainability","ROI","Headcount"];

  document.querySelectorAll("select").forEach(sel => {
    const opts = Array.from(sel.options);
    const first = opts[0];
    const rest = opts.slice(1);
    for (let i = rest.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [rest[i].text, rest[j].text] = [rest[j].text, rest[i].text];
    }
    sel.innerHTML = "";
    sel.appendChild(first);
    rest.forEach(o => sel.appendChild(o));
    sel.selectedIndex = 0;
  });

  const quill = new Quill('#editor', {
    theme: 'snow',
    modules: { toolbar: [['bold','italic','underline'],[{ list: 'ordered' }, { list: 'bullet' }],[{ align: [] }],['clean']] }
  });
  quill.root.addEventListener('paste', e => e.preventDefault());
  quill.root.style.webkitUserSelect = 'text';
  quill.root.style.userSelect = 'text';

  document.getElementById("startBtn").onclick = () => {
    const nameInput = document.getElementById("studentName").value.trim();
    const emailInput = document.getElementById("studentEmail").value.trim();
    const code = document.getElementById("classCode").value.trim();
    if (!nameInput || !emailInput) { alert("Please enter your name and email before starting."); return; }
    if (code !== "MDO2G3") { alert("Invalid class code."); return; }

    document.getElementById("studentNameField").value = nameInput;
    document.getElementById("studentEmailField").value = emailInput;
    document.getElementById("classCodeField").value = code;

    login.style.display = "none";
    exam.style.display = "block";
    partA.classList.add("active");
    partB.classList.remove("active");
    enableFullScreen();
    startTimer();
  };

  document.getElementById("toPartB").addEventListener("click", () => {
    partA.classList.remove("active");
    partB.classList.add("active");
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });
  document.getElementById("toPartA").addEventListener("click", () => {
    partB.classList.remove("active");
    partA.classList.add("active");
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  form.addEventListener("submit", e => {
    e.preventDefault();
    submitExam();
  });

  function submitExam() {
    clearInterval(timerInt);
    const fd = new FormData(form);
    const name = fd.get("studentName") || document.getElementById("studentNameField").value;
    const email = fd.get("studentEmail") || document.getElementById("studentEmailField").value;
    const minutesUsed = 40 - Math.floor(timeLeft / 60);
    let score = 0;
    const rows = [];
    for (let i = 1; i <= 10; i++) {
      const sel = fd.get("q" + i) || "No answer";
      const corr = correctAnswers["q" + i];
      const ok = sel === corr;
      if (ok) score++;
      rows.push({ word: wordNames[i-1], sel, corr, ok });
    }
    const emailHtml = quill.root.innerHTML.replace(/<p><br><\/p>/g, "").trim();
    const partATable = `
      <table style="border-collapse:collapse;width:100%;font-size:15px;margin-top:10px;">
        <thead><tr style="background:#004080;color:#fff;text-align:left;">
          <th style="padding:8px;border:1px solid #ccc;">Word</th>
          <th style="padding:8px;border:1px solid #ccc;">Student Answer</th>
          <th style="padding:8px;border:1px solid #ccc;">Result</th></tr></thead>
        <tbody>${rows.map(r=>`
          <tr><td style="padding:8px;border:1px solid #ccc;">${r.word}</td>
          <td style="padding:8px;border:1px solid #ccc;">${r.sel}</td>
          <td style="padding:8px;border:1px solid #ccc;color:${r.ok?'green':'#b00'};">${r.ok?'‚úÖ Correct':`‚ùå Incorrect ‚Üí Correct answer: ${r.corr}`}</td></tr>`).join("")}
        </tbody>
      </table>`;
    const htmlReport = `
      <h2 style="color:#004080;">English Exam ‚Äì Business Resources ‚Äì ${name} (MDO2G3)</h2>
      <p><b>Student Name:</b> ${name}<br><b>Student Email:</b> ${email}<br><b>Class Code:</b> MDO2G3<br><b>Time Taken:</b> ${minutesUsed} min</p><hr>
      <h3 style="color:#004080;">Part A ‚Äì Vocabulary Matching</h3>${partATable}<p><b>Part A Score:</b> ${score}/10</p><hr>
      <h3 style="color:#004080;">Part B ‚Äì Email Writing & Instructor Feedback</h3>
      <p><b>Student‚Äôs Response:</b></p>
      <div style="border:1px solid #ccc;border-radius:6px;padding:12px;margin-bottom:15px;background:#f9f9f9;">${emailHtml || "<em>(No content)</em>"}</div>
      <table style="border-collapse:collapse;width:100%;font-size:15px;margin-top:10px;">
        <thead><tr style="background:#004080;color:#fff;text-align:left;">
          <th style="padding:8px;border:1px solid #ccc;">Criterion</th>
          <th style="padding:8px;border:1px solid #ccc;">Maximum Score</th>
          <th style="padding:8px;border:1px solid #ccc;">Score Awarded</th></tr></thead>
        <tbody>
          <tr><td style="padding:8px;border:1px solid #ccc;">Vocabulary Use</td><td style="padding:8px;border:1px solid #ccc;">/3</td><td style="padding:8px;border:1px solid #ccc;">___ / 3</td></tr>
          <tr><td style="padding:8px;border:1px solid #ccc;">Structure & Clarity</td><td style="padding:8px;border:1px solid #ccc;">/3</td><td style="padding:8px;border:1px solid #ccc;">___ / 3</td></tr>
          <tr><td style="padding:8px;border:1px solid #ccc;">Language Accuracy & Tone</td><td style="padding:8px;border:1px solid #ccc;">/2</td><td style="padding:8px;border:1px solid #ccc;">___ / 2</td></tr>
          <tr><td style="padding:8px;border:1px solid #ccc;">Professional Style</td><td style="padding:8px;border:1px solid #ccc;">/2</td><td style="padding:8px;border:1px solid #ccc;">___ / 2</td></tr>
        </tbody></table>
      <br><p><b>Instructor Comments:</b></p>
      <p style="border:1px solid #ccc;padding:10px;border-radius:6px;min-height:50px;background:#fdfdfd;">[Type feedback here]</p>
      <h4 style="color:#004080;">Score Summary</h4>
      <table style="border-collapse:collapse;width:100%;max-width:460px;font-size:15px;">
        <tr><td style="padding:8px;border:1px solid #ccc;">Part A Score</td><td style="padding:8px;border:1px solid #ccc;">${score} / 10</td></tr>
        <tr><td style="padding:8px;border:1px solid #ccc;">Part B Score</td><td style="padding:8px;border:1px solid #ccc;">___ / 10</td></tr>
        <tr><td style="padding:8px;border:1px solid #ccc;"><b>Final Note</b></td><td style="padding:8px;border:1px solid #ccc;"><b>___ / 20</b></td></tr>
      </table>
      <div style="border-top:1px solid #ccc;margin-top:20px;padding-top:10px;font-size:13px;"><em>This report was generated automatically for the English Exam ‚Äì Business Resources.</em></div>`;
    emailjs.send("service_opm4h6b","template_r0u784p",{from_name:name,from_email:email,subject:`${name} ‚Äì English Exam ‚Äì Business Resources (MDO2G3)`,message_html:htmlReport})
    .then(()=>{alert("‚úÖ Exam submitted successfully. You may close this window.");document.getElementById("exam").style.display="none";})
    .catch(err=>{alert("‚ùå Error sending exam: " + err.text);console.error("EmailJS Error:",err);});
  }
});
</script>
</head>

<body>
<header>
  <h1>English Exam ‚Äì Business Resources (MDO2G3)</h1>
  <div id="timer"></div>
</header>

<main>
  <section id="login">
    <h2>Start Exam</h2>
    <p>Enter your details to begin. Once started, you will have <b>40 minutes</b>.</p>
    <label>Name:</label><input type="text" id="studentName" required>
    <label>Email:</label><input type="email" id="studentEmail" required>
    <label>Class Code:</label><input type="text" id="classCode" required>
    <div class="btn-row" style="margin-top:10px;"><button id="startBtn">Start
