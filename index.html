<!DOCTYPE html>
<html lang="en" translate="no">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="google" content="notranslate">
<meta http-equiv="Content-Language" content="en">
<meta name="robots" content="no-translate">
<title>English Exam ‚Äì Business Resources</title>

<!-- Quill CSS -->
<link href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css" rel="stylesheet">

<style>
  /* üîí Prevent translation and text copying across browsers */
  html, body { translate: none !important; -webkit-user-select: none; user-select: none; -webkit-touch-callout: none; }
  * { translate: none !important; }

  body {
    font-family: Arial, Helvetica, sans-serif;
    background: #f8f9fb;
    margin: 0;
    color: #222;
    font-size: 16px;
    line-height: 1.6;
  }

  header {
    background: linear-gradient(135deg, #004080, #0066cc);
    color: #ffffff;
    padding: 25px 20px;
    text-align: center;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
  }

  header h1 {
    color: #ffffff;
    font-size: 1.9em;
    margin: 0;
    letter-spacing: 0.5px;
  }

  #timer { text-align: right; font-weight: bold; color: #ffffff; margin-top: 10px; }

  main {
    max-width: 900px;
    margin: 40px auto;
    background: #fff;
    padding: 40px;
    border-radius: 12px;
    box-shadow: 0 0 12px rgba(0, 0, 0, 0.1);
  }

  section { margin-bottom: 32px; }
  .divider { border-bottom: 1px solid #ddd; padding-bottom: 24px; margin-bottom: 28px; }

  /* Center login box */
  #login {
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    padding: 40px;
    max-width: 520px;
    margin: 80px auto;
    text-align: left;
  }
  #login h2 { color: #004080; margin-top: 0; text-align: center; }

  label { display:block; margin: 12px 0 8px; font-weight: bold; }
  input[type="text"], input[type="email"], select { width: 100%; padding: 10px; border:1px solid #ccc; border-radius:6px; }
  textarea { width: 100%; padding: 10px; border:1px solid #ccc; border-radius:6px; }

  /* Make dropdowns roomy so options don‚Äôt get covered */
  select {
    width: 100%;
    max-width: none;
    white-space: normal;
    word-wrap: break-word;
  }

  button {
    background:#004080; color:#fff; border:none; padding:12px 28px; border-radius:6px; cursor:pointer; font-size:16px;
  }
  button:hover { background:#003366; }
  .btn-row { display:flex; gap:12px; flex-wrap: wrap; }
  .btn-light { background:#e9eef7; color:#004080; }
  .btn-light:hover { background:#dbe6f7; }

  ol li { margin-bottom: 14px; }

  /* Two-page layout sections */
  #partA, #partB { display:none; }
  #partA.active, #partB.active { display:block; }

  /* Quill editor container */
  .editor-card {
    border:1px solid #e3e6ee; border-radius:12px; overflow:hidden; box-shadow:0 2px 6px rgba(0,0,0,0.06);
  }
  .ql-toolbar.ql-snow { border:none; border-bottom:1px solid #e3e6ee; background:#f9fbff; }
  .ql-container.ql-snow { border:none; min-height: 260px; }

  .note { font-size: 13px; color:#555; }

</style>

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<!-- Quill JS -->
<script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
  // Initialize EmailJS safely
  if (window.emailjs) {
    emailjs.init("Bb0oPYBiZGQcyIz5r");
  }

  const login = document.getElementById("login");
  const exam = document.getElementById("exam");
  const startBtn = document.getElementById("startBtn");
  const toPartA = document.getElementById("toPartA");
  const toPartB = document.getElementById("toPartB");
  const partA = document.getElementById("partA");
  const partB = document.getElementById("partB");
  const timerDisplay = document.getElementById("timer");
  const form = document.getElementById("examForm");

  let timeLeft = 40 * 60;
  let timer;

  const correctAnswers = {
    q1:"A plan for how money will be spent during a specific period.",
    q2:"A prediction of future sales, costs, or results.",
    q3:"A measurable value showing how effectively goals are achieved.",
    q4:"A company providing goods or services to another.",
    q5:"The time between ordering and receiving something."
  };

  const wordNames = ["Budget","Forecast","KPI","Supplier","Lead Time"];

  const quill = new Quill('#editor', {
    theme: 'snow',
    modules: { toolbar: [['bold','italic','underline'],[{ list: 'ordered' }, { list: 'bullet' }],['clean']] }
  });

  function startTimer() {
    timer = setInterval(() => {
      timeLeft--;
      const m = Math.floor(timeLeft / 60), s = timeLeft % 60;
      timerDisplay.textContent = `Time Remaining: ${m}:${s.toString().padStart(2,"0")}`;
      if (timeLeft <= 0) { clearInterval(timer); submitExam(); }
    }, 1000);
  }

  function enableFullScreen() {
    if (document.documentElement.requestFullscreen) {
      document.documentElement.requestFullscreen();
      document.addEventListener("fullscreenchange", () => {
        if (!document.fullscreenElement) {
          alert("Exam terminated. Fullscreen required.");
          location.reload();
        }
      });
    }
  }

  // ‚úÖ START BUTTON FIX
  startBtn.addEventListener("click", () => {
    const name = document.getElementById("studentName").value.trim();
    const email = document.getElementById("studentEmail").value.trim();
    const code = document.getElementById("classCode").value.trim();

    if (!name || !email) return alert("Please fill in your details.");
    if (code !== "MDO2G3") return alert("Invalid class code.");

    document.getElementById("studentNameField").value = name;
    document.getElementById("studentEmailField").value = email;
    document.getElementById("classCodeField").value = code;

    login.classList.remove("active");
    exam.classList.add("active");
    partA.classList.add("active");
    enableFullScreen();
    startTimer();
  });

  toPartB.addEventListener("click", () => {
    partA.classList.remove("active");
    partB.classList.add("active");
  });
  toPartA.addEventListener("click", () => {
    partB.classList.remove("active");
    partA.classList.add("active");
  });

  form.addEventListener("submit", e => {
    e.preventDefault();
    submitExam();
  });

  function submitExam() {
    clearInterval(timer);
    const fd = new FormData(form);
    const name = fd.get("studentName") || document.getElementById("studentNameField").value;
    const email = fd.get("studentEmail") || document.getElementById("studentEmailField").value;
    const minutesUsed = 40 - Math.floor(timeLeft / 60);
    const emailHtml = quill.root.innerHTML.trim();

    let score = 0;
    const rows = [];
    for (let i = 1; i <= 5; i++) {
      const sel = fd.get("q" + i) || "No answer";
      const corr = correctAnswers["q" + i];
      const ok = sel === corr;
      if (ok) score++;
      rows.push({ word: wordNames[i-1], sel, corr, ok });
    }

    const htmlReport = `
    <h2 style="color:#004080;">English Exam ‚Äì ${name}</h2>
    <p><b>Student:</b> ${name}<br><b>Email:</b> ${email}<br><b>Time Used:</b> ${minutesUsed} min</p>
    <hr>
    <h3>Part A ‚Äì Vocabulary</h3>
    <table style="border-collapse:collapse;width:100%;">
    ${rows.map(r=>`
      <tr>
        <td style="border:1px solid #ccc;padding:5px;">${r.word}</td>
        <td style="border:1px solid #ccc;padding:5px;">${r.sel}</td>
        <td style="border:1px solid #ccc;padding:5px;color:${r.ok?'green':'red'};">${r.ok?'‚úÖ':'‚ùå'} ${r.ok?'':'‚Üí '+r.corr}</td>
      </tr>`).join("")}
    </table>
    <p><b>Part A Score:</b> ${score}/5</p>
    <hr>
    <h3>Part B ‚Äì Student Response</h3>
    <div style="border:1px solid #ccc;padding:10px;border-radius:6px;background:#f9f9f9;">${emailHtml}</div>
    <p><b>Instructor Comments:</b></p>
    <p style="border:1px solid #ccc;padding:10px;border-radius:6px;background:#fdfdfd;">[Type feedback here]</p>
    <p><b>Final Score:</b> ___ / 20</p>`;

    if (window.emailjs) {
      emailjs.send("service_opm4h6b","template_r0u784p",{
        from_name:name,
        from_email:email,
        subject:`${name} ‚Äì English Exam ‚Äì Business Resources (MDO2G3)`,
        message_html:htmlReport
      }).then(()=>{
        alert("‚úÖ Exam submitted successfully.");
        exam.style.display = "none";
      }).catch(err=>{
        alert("‚ùå Error sending exam: "+err.text);
      });
    } else {
      alert("EmailJS not loaded; submission simulated.");
    }
  }
});
</script>
</head>

<body>
<header>
  <h1>English Exam ‚Äì Business Resources (MDO2G3)</h1>
  <div id="timer"></div>
</header>

<main>
  <section id="login">
    <h2>Start Exam</h2>
    <p>Enter your details to begin. Once started, you will have <b>40 minutes</b>.</p>
    <label>Name:</label><input type="text" id="studentName" required>
    <label>Email:</label><input type="email" id="studentEmail" required>
    <label>Class Code:</label><input type="text" id="classCode" required>
    <div class="btn-row" style="margin-top:10px;"><button id="startBtn">Start
