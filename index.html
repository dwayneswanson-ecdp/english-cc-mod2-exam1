<!DOCTYPE html>
<html lang="en" translate="no">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="google" content="notranslate">
<meta http-equiv="Content-Language" content="en">
<meta name="robots" content="no-translate">
<title>English Exam ‚Äì Business Resources</title>

<!-- Quill CSS -->
<link href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css" rel="stylesheet">

<style>
  /* üîí Prevent translation and text copying across browsers */
  html, body { translate: none !important; -webkit-user-select: none; user-select: none; -webkit-touch-callout: none; }
  * { translate: none !important; }

  body {
    font-family: Arial, Helvetica, sans-serif;
    background: #f8f9fb;
    margin: 0;
    color: #222;
    font-size: 16px;
    line-height: 1.6;
  }

  header {
    background: linear-gradient(135deg, #004080, #0066cc);
    color: #ffffff;
    padding: 25px 20px;
    text-align: center;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
  }

  header h1 { color: #ffffff; font-size: 1.9em; margin: 0; letter-spacing: 0.5px; }
  #timer { text-align: right; font-weight: bold; color: #ffffff; margin-top: 10px; }

  main {
    max-width: 900px;
    margin: 40px auto;
    background: #fff;
    padding: 40px;
    border-radius: 12px;
    box-shadow: 0 0 12px rgba(0, 0, 0, 0.1);
  }

  /* Center login card */
  #login {
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    padding: 40px;
    max-width: 520px;
    margin: 80px auto;
    text-align: left;
  }
  #login h2 { color: #004080; margin-top: 0; text-align: center; }

  label { display:block; margin: 12px 0 8px; font-weight: bold; }
  input[type="text"], input[type="email"] { width: 100%; padding: 10px; border:1px solid #ccc; border-radius:6px; }
  textarea { width: 100%; padding: 10px; border:1px solid #ccc; border-radius:6px; }

  select {
    width: 100%;
    max-width: none;
    white-space: normal;
    word-wrap: break-word;
    padding: 8px;
    border:1px solid #ccc;
    border-radius:6px;
  }

  button {
    background:#004080; color:#fff; border:none; padding:12px 28px; border-radius:6px; cursor:pointer; font-size:16px;
  }
  button:hover { background:#003366; }

  .btn-row { display:flex; gap:12px; flex-wrap: wrap; margin-top: 16px; }
  .btn-row.right { justify-content: flex-end; }
  .btn-light { background:#e9eef7; color:#004080; }
  .btn-light:hover { background:#dbe6f7; }

  ol { padding-left: 20px; }
  ol li { margin-bottom: 14px; }

  /* Two-page layout sections */
  #exam { display:none; }
  #partA, #partB { display:none; }
  #partA.active, #partB.active { display:block; }

  /* Quill editor container */
  .editor-card {
    border:1px solid #e3e6ee; border-radius:12px; overflow:hidden; box-shadow:0 2px 6px rgba(0,0,0,0.06);
  }
  .ql-toolbar.ql-snow { border:none; border-bottom:1px solid #e3e6ee; background:#f9fbff; }
  .ql-container.ql-snow { border:none; min-height: 260px; }
  .ql-editor { min-height: 240px; } /* ensures full box is clickable */

  .muted { color:#666; font-size: 14px; }
</style>
</head>

<body>
<header>
  <h1>English Exam ‚Äì Business Resources (MDO2G3)</h1>
  <div id="timer"></div>
</header>

<main>
  <!-- LOGIN -->
  <section id="login">
    <h2>Start Exam</h2>
    <p>Enter your details to begin. Once started, you will have <b>40 minutes</b>.</p>
    <label>Name:</label><input type="text" id="studentName" required>
    <label>Email:</label><input type="email" id="studentEmail" required>
    <label>Class Code:</label><input type="text" id="classCode" required>

    <div class="btn-row" style="justify-content:center;">
      <button id="startBtn">Start Exam</button>
    </div>
  </section>

  <!-- EXAM -->
  <section id="exam">
    <form id="examForm">
      <input type="hidden" name="studentName" id="studentNameField">
      <input type="hidden" name="studentEmail" id="studentEmailField">
      <input type="hidden" name="classCode" id="classCodeField">

      <!-- PART A -->
      <div id="partA" class="active">
        <h2>Part A ‚Äì Vocabulary Matching</h2>
        <ol>
          <li>Budget
            <select name="q1">
              <option value="">-- Choose --</option>
              <option>A plan for how money will be spent during a specific period.</option>
              <option>The time between ordering and receiving something.</option>
              <option>The goods and materials a company holds.</option>
              <option>A company providing goods or services to another.</option>
              <option>Ongoing expenses not tied to one product or service.</option>
            </select>
          </li>
          <li>Forecast
            <select name="q2">
              <option value="">-- Choose --</option>
              <option>A prediction of future sales, costs, or results.</option>
              <option>Ongoing expenses not tied to one product or service.</option>
              <option>Financial gain or loss compared to cost of investment.</option>
              <option>Number of employees in a company or department.</option>
              <option>The goods and materials a company holds.</option>
            </select>
          </li>
          <li>KPI
            <select name="q3">
              <option value="">-- Choose --</option>
              <option>A measurable value showing how effectively goals are achieved.</option>
              <option>A plan for how money will be spent during a specific period.</option>
              <option>A prediction of future sales, costs, or results.</option>
              <option>The time between ordering and receiving something.</option>
              <option>The goods and materials a company holds.</option>
            </select>
          </li>
          <li>Supplier
            <select name="q4">
              <option value="">-- Choose --</option>
              <option>A company providing goods or services to another.</option>
              <option>Ongoing expenses not tied to one product or service.</option>
              <option>Managing resources for long-term balance.</option>
              <option>Financial gain or loss compared to cost of investment.</option>
              <option>Number of employees in a company or department.</option>
            </select>
          </li>
          <li>Lead Time
            <select name="q5">
              <option value="">-- Choose --</option>
              <option>The time between ordering and receiving something.</option>
              <option>Extra costs of running a business.</option>
              <option>Number of employees in a company or department.</option>
              <option>A business sustainability report.</option>
              <option>A plan for how money will be spent during a specific period.</option>
            </select>
          </li>
          <li>Inventory
            <select name="q6">
              <option value="">-- Choose --</option>
              <option>The goods and materials a company holds.</option>
              <option>The expected revenue.</option>
              <option>The time between orders.</option>
              <option>Company overhead costs.</option>
              <option>Financial gain or loss compared to cost of investment.</option>
            </select>
          </li>
          <li>Overhead
            <select name="q7">
              <option value="">-- Choose --</option>
              <option>Ongoing expenses not tied to one product or service.</option>
              <option>A plan for company goals.</option>
              <option>The delivery delay period.</option>
              <option>The total sales revenue.</option>
              <option>Managing resources for long-term balance.</option>
            </select>
          </li>
          <li>Sustainability
            <select name="q8">
              <option value="">-- Choose --</option>
              <option>Managing resources for long-term balance.</option>
              <option>The company‚Äôs annual sales.</option>
              <option>A measurable performance indicator.</option>
              <option>Stock of materials.</option>
              <option>Number of employees in a company or department.</option>
            </select>
          </li>
          <li>ROI
            <select name="q9">
              <option value="">-- Choose --</option>
              <option>Financial gain or loss compared to cost of investment.</option>
              <option>Total operating expenses.</option>
              <option>Employee satisfaction level.</option>
              <option>Plan for spending.</option>
              <option>Ongoing expenses not tied to one product or service.</option>
            </select>
          </li>
          <li>Headcount
            <select name="q10">
              <option value="">-- Choose --</option>
              <option>Number of employees in a company or department.</option>
              <option>Amount of raw materials held.</option>
              <option>Prediction of future costs.</option>
              <option>Profit after expenses.</option>
              <option>The time between ordering and receiving something.</option>
            </select>
          </li>
        </ol>

        <div class="btn-row right">
          <button type="button" id="toPartB">Next ‚Üí Part B</button>
        </div>
      </div>

      <!-- PART B -->
      <div id="partB">
        <h2>Part B ‚Äì Writing Task</h2>
        <p class="muted">You are a team leader. One of your suppliers has delayed an important delivery. Write a short email to your manager explaining the problem and suggesting a solution. Use at least <b>3 words from the vocabulary list</b>.</p>

        <div class="editor-card">
          <div id="editor"></div>
        </div>

        <div class="btn-row">
          <button type="button" class="btn-light" id="toPartA">‚Üê Back to Part A</button>
          <button type="submit">Submit Exam</button>
        </div>
      </div>
    </form>
  </section>
</main>

<!-- JS at the end (load once) -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
  // Init EmailJS
  if (window.emailjs) { emailjs.init("Bb0oPYBiZGQcyIz5r"); }

  // Grab elements
  const login = document.getElementById("login");
  const exam = document.getElementById("exam");
  const startBtn = document.getElementById("startBtn");
  const toPartA = document.getElementById("toPartA");
  const toPartB = document.getElementById("toPartB");
  const partA = document.getElementById("partA");
  const partB = document.getElementById("partB");
  const timerDisplay = document.getElementById("timer");
  const form = document.getElementById("examForm");

  // Timer
  let timeLeft = 40 * 60;
  let timer;

  // Correct answers (10)
  const correctAnswers = {
    q1:"A plan for how money will be spent during a specific period.",
    q2:"A prediction of future sales, costs, or results.",
    q3:"A measurable value showing how effectively goals are achieved.",
    q4:"A company providing goods or services to another.",
    q5:"The time between ordering and receiving something.",
    q6:"The goods and materials a company holds.",
    q7:"Ongoing expenses not tied to one product or service.",
    q8:"Managing resources for long-term balance.",
    q9:"Financial gain or loss compared to cost of investment.",
    q10:"Number of employees in a company or department."
  };

  const wordNames = ["Budget","Forecast","KPI","Supplier","Lead Time","Inventory","Overhead","Sustainability","ROI","Headcount"];

  // Quill editor
  const quill = new Quill('#editor', {
    theme: 'snow',
    modules: {
      toolbar: [
        ['bold','italic','underline'],
        [{ list: 'ordered' }, { list: 'bullet' }],
        ['clean']
      ]
    }
  });

  // Helpers
  function startTimer() {
    timer = setInterval(() => {
      timeLeft--;
      const m = Math.floor(timeLeft / 60), s = timeLeft % 60;
      timerDisplay.textContent = `Time Remaining: ${m}:${s.toString().padStart(2,"0")}`;
      if (timeLeft <= 0) { clearInterval(timer); submitExam(); }
    }, 1000);
  }

  function enableFullScreen() {
    document.documentElement.requestFullscreen?.();
    document.addEventListener("fullscreenchange", () => {
      if (!document.fullscreenElement) {
        alert("Exam terminated. Fullscreen required.");
        location.reload();
      }
    });
  }

  function randomizeSelectsKeepFirst() {
    document.querySelectorAll("#partA select").forEach(sel => {
      const opts = Array.from(sel.options);
      const first = opts.shift(); // remove "-- Choose --"
      // Shuffle remaining
      for (let i = opts.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [opts[i].text, opts[j].text] = [opts[j].text, opts[i].text];
      }
      sel.innerHTML = "";
      sel.appendChild(first);
      opts.forEach(o => sel.appendChild(o));
      sel.selectedIndex = 0;
    });
  }

  // Start button
  startBtn.addEventListener("click", () => {
    const name = document.getElementById("studentName").value.trim();
    const email = document.getElementById("studentEmail").value.trim();
    const code = document.getElementById("classCode").value.trim();

    if (!name || !email) return alert("Please fill in your details.");
    if (code !== "MDO2G3") return alert("Invalid class code.");

    document.getElementById("studentNameField").value = name;
    document.getElementById("studentEmailField").value = email;
    document.getElementById("classCodeField").value = code;

    // Show exam
    login.style.display = "none";
    exam.style.display = "block";
    partA.classList.add("active");
    partB.classList.remove("active");

    // Anti-cheat + timer
    enableFullScreen();
    startTimer();
    randomizeSelectsKeepFirst();
  });

  // Nav between parts
  toPartB.addEventListener("click", () => {
    partA.classList.remove("active");
    partB.classList.add("active");
  });
  toPartA.addEventListener("click", () => {
    partB.classList.remove("active");
    partA.classList.add("active");
  });

  // Submit
  form.addEventListener("submit", e => {
    e.preventDefault();
    submitExam();
  });

function submitExam() {
  clearInterval(timer);

  const fd = new FormData(form);
  const name  = fd.get("studentName")  || document.getElementById("studentNameField").value;
  const email = fd.get("studentEmail") || document.getElementById("studentEmailField").value;
  const minutesUsed = 40 - Math.floor(timeLeft / 60);

  // Pull the rich-text answer from Quill (Part B)
  const emailHtml = (window.quill ? quill.root.innerHTML.trim() : (fd.get("emailBody") || ""));

  // Detect how many questions are on the page (works for 5 or 10)
  const totalQs = document.querySelectorAll('select[name^="q"]').length || 10;

  // Words in order (we‚Äôll slice to totalQs)
  const wordNamesAll = ["Budget","Forecast","KPI","Supplier","Lead Time","Inventory","Overhead","Sustainability","ROI","Headcount"];
  const wordNames = wordNamesAll.slice(0, totalQs);

  // Correct answers (ensure you have entries for however many questions you render)
  const correctAnswersFull = {
    q1: "A plan for how money will be spent during a specific period.",
    q2: "A prediction of future sales, costs, or results.",
    q3: "A measurable value showing how effectively goals are achieved.",
    q4: "A company providing goods or services to another.",
    q5: "The time between ordering and receiving something.",
    q6: "The goods and materials a company holds.",
    q7: "Ongoing expenses not tied to one product or service.",
    q8: "Managing resources for long-term balance.",
    q9: "Financial gain or loss compared to cost of investment.",
    q10:"Number of employees in a company or department."
  };

  let scoreA = 0;
  const partARowsHTML = Array.from({ length: totalQs }, (_, idx) => {
    const i = idx + 1;
    const sel  = fd.get("q" + i) || "No answer";
    const corr = correctAnswersFull["q" + i] || "";
    const ok   = sel === corr;
    if (ok) scoreA++;
    const mark = ok ? "‚úÖ Correct" : `‚ùå Incorrect ‚Üí Correct answer: ${corr}`;
    return `
      <tr>
        <td style="padding:8px;border:1px solid #ccc;">${wordNames[idx] || ("Q" + i)}</td>
        <td style="padding:8px;border:1px solid #ccc;">${sel}</td>
        <td style="padding:8px;border:1px solid #ccc;color:${ok ? 'green' : '#b00'};">${mark}</td>
      </tr>`;
  }).join("");

  // If you don‚Äôt want auto-grading for Part B, leave placeholders:
  const partBScore = "___ / 10";
  const finalNote  = "___ / 20";
  const instructorCommentsPlaceholder = "[Type feedback here]";

  // Build the HTML report (mail-client friendly inline styles)
  const htmlReport = `
    <h2 style="color:#004080;margin:0 0 8px 0;">English Exam ‚Äì Business Resources ‚Äì ${name} (MDO2G3)</h2>
    <table style="border-collapse:collapse;width:100%;max-width:640px;font-size:14px;margin:0 0 12px 0;">
      <tr><td style="padding:4px 0;"><b>Student Name:</b> ${name}</td></tr>
      <tr><td style="padding:4px 0;"><b>Student Email:</b> ${email}</td></tr>
      <tr><td style="padding:4px 0;"><b>Class Code:</b> MDO2G3</td></tr>
      <tr><td style="padding:4px 0;"><b>Time Taken:</b> ${minutesUsed} min</td></tr>
    </table>
    <hr style="border:none;border-top:1px solid #ddd;margin:14px 0;">

    <h3 style="color:#004080;margin:10px 0 8px 0;">Part A ‚Äì Vocabulary Matching</h3>
    <table style="border-collapse:collapse;width:100%;font-size:15px;margin-top:8px;">
      <thead>
        <tr style="background:#004080;color:#fff;text-align:left;">
          <th style="padding:8px;border:1px solid #ccc;">Word</th>
          <th style="padding:8px;border:1px solid #ccc;">Student Answer</th>
          <th style="padding:8px;border:1px solid #ccc;">Result</th>
        </tr>
      </thead>
      <tbody>
        ${partARowsHTML}
      </tbody>
    </table>
    <p style="margin:10px 0 0 0;"><b>Part A Score:</b> ${scoreA} / ${totalQs}</p>

    <hr style="border:none;border-top:1px solid #ddd;margin:16px 0;">

    <h3 style="color:#004080;margin:10px 0 8px 0;">Part B ‚Äì Student Response</h3>
    <div style="border:1px solid #ccc;border-radius:6px;padding:10px;background:#f9f9f9;">
      ${emailHtml || "<em>(No response)</em>"}
    </div>
    <p style="margin:10px 0 0 0;"><b>Part B Score:</b> ${partBScore}</p>

    <hr style="border:none;border-top:1px solid #ddd;margin:16px 0;">

    <h3 style="color:#004080;margin:10px 0 8px 0;">Instructor Feedback & Final Scores</h3>

    <!-- Optional rubric (keep if you like it) -->
    <table style="border-collapse:collapse;width:100%;font-size:15px;margin-top:6px;">
      <thead>
        <tr style="background:#004080;color:#fff;text-align:left;">
          <th style="padding:8px;border:1px solid #ccc;">Criterion</th>
          <th style="padding:8px;border:1px solid #ccc;">Maximum</th>
          <th style="padding:8px;border:1px solid #ccc;">Awarded</th>
        </tr>
      </thead>
      <tbody>
        <tr><td style="padding:8px;border:1px solid #ccc;">Vocabulary Use</td><td style="padding:8px;border:1px solid #ccc;">/3</td><td style="padding:8px;border:1px solid #ccc;">___ / 3</td></tr>
        <tr><td style="padding:8px;border:1px solid #ccc;">Structure & Clarity</td><td style="padding:8px;border:1px solid #ccc;">/3</td><td style="padding:8px;border:1px solid #ccc;">___ / 3</td></tr>
        <tr><td style="padding:8px;border:1px solid #ccc;">Language Accuracy & Tone</td><td style="padding:8px;border:1px solid #ccc;">/2</td><td style="padding:8px;border:1px solid #ccc;">___ / 2</td></tr>
        <tr><td style="padding:8px;border:1px solid #ccc;">Professional Style</td><td style="padding:8px;border:1px solid #ccc;">/2</td><td style="padding:8px;border:1px solid #ccc;">___ / 2</td></tr>
      </tbody>
    </table>

    <p style="margin:12px 0 6px 0;"><b>Instructor Comments:</b></p>
    <div style="border:1px solid #ccc;border-radius:6px;padding:10px;background:#fdfdfd;min-height:48px;">
      ${instructorCommentsPlaceholder}
    </div>

    <h4 style="color:#004080;margin:14px 0 6px 0;">Score Summary</h4>
    <table style="border-collapse:collapse;width:100%;max-width:460px;font-size:15px;">
      <tr>
        <td style="padding:8px;border:1px solid #ccc;">Part A Score</td>
        <td style="padding:8px;border:1px solid #ccc;">${scoreA} / ${totalQs}</td>
      </tr>
      <tr>
        <td style="padding:8px;border:1px solid #ccc;">Part B Score</td>
        <td style="padding:8px;border:1px solid #ccc;">${partBScore}</td>
      </tr>
      <tr>
        <td style="padding:8px;border:1px solid #ccc;"><b>Final Note</b></td>
        <td style="padding:8px;border:1px solid #ccc;"><b>${finalNote}</b></td>
      </tr>
    </table>

    <div style="border-top:1px solid #ccc;margin-top:16px;padding-top:8px;font-size:12px;color:#555;">
      <em>This report was generated automatically for the English Exam ‚Äì Business Resources.</em>
    </div>
  `;

  // Subject line with student name
  const subject = `${name} ‚Äì English Exam ‚Äì Business Resources (MDO2G3)`;

  emailjs.send("service_opm4h6b", "template_r0u784p", {
    from_name: name,
    from_email: email,
    subject,
    message_html: htmlReport
  })
  .then(() => {
    alert("‚úÖ Exam submitted successfully.");
    document.getElementById("exam").style.display = "none";
  })
  .catch(err => {
    alert("‚ùå Error sending exam: " + (err && err.text ? err.text : err));
    console.error("EmailJS Error:", err);
  });
}
</script>
</body>
</html>
